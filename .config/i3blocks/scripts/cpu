#!/bin/bash
# Lee /proc/stat dos veces con delay para calcular uso instantáneo

read_cpu() {
    grep 'cpu ' /proc/stat | awk '{print $2, $3, $4, $5, $6, $7, $8}'
}

# Primera lectura
read -r user1 nice1 system1 idle1 iowait1 irq1 softirq1 <<< "$(read_cpu)"
total1=$((user1 + nice1 + system1 + idle1 + iowait1 + irq1 + softirq1))
idle_total1=$((idle1 + iowait1))

# Espera 0.5 segundos
sleep 0.5

# Segunda lectura
read -r user2 nice2 system2 idle2 iowait2 irq2 softirq2 <<< "$(read_cpu)"
total2=$((user2 + nice2 + system2 + idle2 + iowait2 + irq2 + softirq2))
idle_total2=$((idle2 + iowait2))

# Calcula diferencia
total_diff=$((total2 - total1))
idle_diff=$((idle_total2 - idle_total1))

# Calcula porcentaje de uso
if [ "$total_diff" -gt 0 ]; then
    USAGE=$(( (total_diff - idle_diff) * 100 / total_diff ))
else
    USAGE=0
fi

# Color según uso
if [ "$USAGE" -ge 90 ]; then
    COLOR="#FF0000"  # Rojo
elif [ "$USAGE" -ge 70 ]; then
    COLOR="#FFFF00"  # Amarillo
else
    COLOR="#00FF00"  # Verde
fi

printf "CPU %02d%%\n" "$USAGE"
printf "CPU %02d%%\n" "$USAGE"
echo "$COLOR"
